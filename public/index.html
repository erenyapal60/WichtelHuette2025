<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wichteln 2025</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: linear-gradient(135deg, #0d47a1, #1976d2, #26c6da);
      font-family: "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      overflow: hidden;
    }

    /* Mehrschichtiger Schnee */
    canvas.snow {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    canvas.snow2 {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 9;
      opacity: 0.6;
    }

    canvas.snow3 {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 8;
      opacity: 0.3;
    }

    /* Karte */
    .card {
      position: relative;
      z-index: 20;
      width: 90%;
      max-width: 380px;
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(12px);
      padding: 32px;
      border-radius: 20px;

      /* Snow glow */
      box-shadow: 0 0 40px rgba(255,255,255,0.15);

      text-align: center;
      animation: fadeIn .7s ease;
      transition: transform .1s ease;
    }

    /* 3D Tilt */
    .card.tilt {
      transform-style: preserve-3d;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Pulsierender Titel */
    h1 {
      margin: 0 0 20px 0;
      font-size: 28px;
      font-weight: 600;
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: .85; }
      100% { opacity: 1; }
    }

    /* Input & Button */
    input, button {
      width: 100%;
      box-sizing: border-box;
      padding: 14px;
      border-radius: 12px;
      font-size: 18px;
      border: none;
    }

    input {
      margin-top: 10px;
      background: rgba(255,255,255,0.9);
      color: #0d47a1;
      font-weight: 600;
      -webkit-text-fill-color: #0d47a1 !important;
      caret-color: #0d47a1;
      text-align: center;
    }

    input::placeholder {
      color: #5c6bc0;
      opacity: 1;
    }

    input:focus {
      background: white;
      transform: scale(1.03);
    }

    button {
      margin-top: 14px;
      background: #90caf9;
      color: #0d47a1;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    /* Premium Glow Button */
    button:hover {
      background: #bbdefb;
      box-shadow: 0 0 12px rgba(255,255,255,0.4);
      transform: scale(1.05);
    }

    /* Ergebnis-Reveal */
    #output {
      margin-top: 22px;
      font-size: 18px;
      font-weight: 500;
      min-height: 30px;
    }

    .reveal {
      animation: pop .4s ease;
    }

    @keyframes pop {
      0% { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1); }
    }
  </style>
</head>

<body>

<!-- 3 Ebenen Schnee -->
<canvas class="snow"></canvas>
<canvas class="snow2"></canvas>
<canvas class="snow3"></canvas>

<div class="card tilt">
  <h1>üéÅ Wichteln 2025 ‚ùÑÔ∏è</h1>

  <input id="pin" maxlength="6" placeholder="PIN eingeben">
  <button onclick="checkPIN()">Partner anzeigen</button>

  <div id="output"></div>
</div>

<script>
async function checkPIN() {
  const pin = document.getElementById("pin").value.trim();
  const out = document.getElementById("output");
  out.classList.remove("reveal");

  if (!pin) {
    out.textContent = "Bitte PIN eingeben.";
    return;
  }

  const res = await fetch("/check", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ pin })
  });

  const txt = await res.text();

  try {
    const data = JSON.parse(txt);
    out.innerHTML = `Hallo <b>${data.name}</b>!<br>Du beschenkst: <b>${data.target}</b> ‚ùÑÔ∏è`;
  } catch {
    out.textContent = txt;
  }

  out.classList.add("reveal");
}

/* --- Realistic Snow System (3 Layers) --- */
function snowLayer(selector, speedMin, speedMax, count) {
  const canvas = document.querySelector(selector);
  const ctx = canvas.getContext("2d");

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener("resize", resize);

  let flakes = [];
  for (let i = 0; i < count; i++) {
    flakes.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 3 + 1,
      s: Math.random() * (speedMax - speedMin) + speedMin
    });
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    flakes.forEach(f => {
      ctx.beginPath();
      ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
      ctx.fill();
    });
    update();
    requestAnimationFrame(draw);
  }

  function update() {
    flakes.forEach(f => {
      f.y += f.s;
      if (f.y > canvas.height) {
        f.y = -5;
        f.x = Math.random() * canvas.width;
      }
    });
  }

  draw();
}

snowLayer(".snow", 1.2, 2.0, 100);
snowLayer(".snow2", 0.7, 1.4, 120);
snowLayer(".snow3", 0.3, 0.8, 140);

/* --- 3D Tilt Effect --- */
const card = document.querySelector(".card");
document.addEventListener("mousemove", e => {
  const x = (window.innerWidth / 2 - e.clientX) / 40;
  const y = (window.innerHeight / 2 - e.clientY) / 40;
  card.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
});
</script>

</body>
</html>
